
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<link href="http://0.0.0.0:8000/architecture/" rel="canonical"/>
<link href=".." rel="prev"/>
<link href="../deployment/" rel="next"/>
<link href="../assets/images/favicon.png" rel="icon"/>
<meta content="mkdocs-1.6.1, mkdocs-material-9.7.1" name="generator"/>
<title>Architecture - ScopeMArchiver</title>
<link href="../assets/stylesheets/main.484c7ddc.min.css" rel="stylesheet"/>
<link href="../assets/stylesheets/palette.ab4e12ef.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
<link href="../assets/_mkdocstrings.css" rel="stylesheet"/>
<link href="../assets/stylesheets/panzoom.css" rel="stylesheet"/>
<script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
<meta name="panzoom-theme" content="material">
<meta name="panzoom-data" content='{"selectors": [".mermaid", ".d2"], "initial_zoom_level": 1.0}'> </head>
<body data-md-color-accent="indigo" data-md-color-primary="teal" data-md-color-scheme="default" dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#architecture">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header md-header--shadow" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="ScopeMArchiver" class="md-header__button md-logo" data-md-component="logo" href=".." title="ScopeMArchiver">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            ScopeMArchiver
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              Architecture
            
          </span>
</div>
</div>
</div>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" title="Clear" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
</button>
</nav>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="" tabindex="0">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
<div class="md-header__source">
<a class="md-source" data-md-component="source" href="https://github.com/SwissOpenEM/ScopeMArchiver" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"></path></svg>
</div>
<div class="md-source__repository">
    SwissOpenEM/ScopeMArchiver
  </div>
</a>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary md-nav--integrated" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="ScopeMArchiver" class="md-nav__button md-logo" data-md-component="logo" href=".." title="ScopeMArchiver">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg>
</a>
    ScopeMArchiver
  </label>
<div class="md-nav__source">
<a class="md-source" data-md-component="source" href="https://github.com/SwissOpenEM/ScopeMArchiver" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"></path></svg>
</div>
<div class="md-source__repository">
    SwissOpenEM/ScopeMArchiver
  </div>
</a>
</div>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="..">
<span class="md-ellipsis">
    
  
    Introduction
  

    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
<span class="md-ellipsis">
    
  
    Architecture
  

    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
<span class="md-ellipsis">
    
  
    Architecture
  

    
  </span>
</a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#component-diagram">
<span class="md-ellipsis">
      
        Component Diagram
      
    </span>
</a>
<nav aria-label="Component Diagram" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#components">
<span class="md-ellipsis">
      
        Components
      
    </span>
</a>
<nav aria-label="Components" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#archiver-service">
<span class="md-ellipsis">
      
        Archiver Service
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#workflow-orchestration">
<span class="md-ellipsis">
      
        Workflow Orchestration
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#storage-components">
<span class="md-ellipsis">
      
        Storage Components
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#external-components">
<span class="md-ellipsis">
      
        External Components
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#authentication">
<span class="md-ellipsis">
      
        Authentication
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../deployment/">
<span class="md-ellipsis">
    
  
    Deployment
  

    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
<span class="md-ellipsis">
    
  
    Flows
  

    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_4">
<span class="md-nav__icon md-icon"></span>
            
  
    Flows
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../upload_flow/">
<span class="md-ellipsis">
    
  
    Ingestion
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../archival_retrieval_flow/">
<span class="md-ellipsis">
    
  
    Archival and Retrieval
  

    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_5" type="checkbox"/>
<label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
<span class="md-ellipsis">
    
  
    Code Reference
  

    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_5">
<span class="md-nav__icon md-icon"></span>
            
  
    Code Reference
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../reference/Summary/">
<span class="md-ellipsis">
    
  
    Summary
  

    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_5_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_5_2" id="__nav_5_2_label" tabindex="0">
<span class="md-ellipsis">
    
  
    Config
  

    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_2_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_5_2">
<span class="md-nav__icon md-icon"></span>
            
  
    Config
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../reference/config/blocks/">
<span class="md-ellipsis">
    
  
    Blocks
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../reference/config/concurrency_limits/">
<span class="md-ellipsis">
    
  
    Concurrency limits
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../reference/config/variables/">
<span class="md-ellipsis">
    
  
    Variables
  

    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_5_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_5_3" id="__nav_5_3_label" tabindex="0">
<span class="md-ellipsis">
    
  
    Flows
  

    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_3_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_5_3">
<span class="md-nav__icon md-icon"></span>
            
  
    Flows
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../reference/flows/archive_datasets_flow/">
<span class="md-ellipsis">
    
  
    Archive datasets flow
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../reference/flows/flow_utils/">
<span class="md-ellipsis">
    
  
    Flow utils
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../reference/flows/mock_flows/">
<span class="md-ellipsis">
    
  
    Mock flows
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../reference/flows/retrieve_datasets_flow/">
<span class="md-ellipsis">
    
  
    Retrieve datasets flow
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../reference/flows/task_utils/">
<span class="md-ellipsis">
    
  
    Task utils
  

    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_5_3_6" type="checkbox"/>
<label class="md-nav__link" for="__nav_5_3_6" id="__nav_5_3_6_label" tabindex="0">
<span class="md-ellipsis">
    
  
    Tests
  

    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_3_6_label" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_5_3_6">
<span class="md-nav__icon md-icon"></span>
            
  
    Tests
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../reference/flows/tests/conftest/">
<span class="md-ellipsis">
    
  
    Conftest
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../reference/flows/tests/helpers/">
<span class="md-ellipsis">
    
  
    Helpers
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../reference/flows/tests/scicat_unittest_mock/">
<span class="md-ellipsis">
    
  
    Scicat unittest mock
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../reference/flows/tests/test_archival_flow/">
<span class="md-ellipsis">
    
  
    Test archival flow
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../reference/flows/tests/test_retrieval_flow/">
<span class="md-ellipsis">
    
  
    Test retrieval flow
  

    
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_5_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_5_4" id="__nav_5_4_label" tabindex="0">
<span class="md-ellipsis">
    
  
    Scicat
  

    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_4_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_5_4">
<span class="md-nav__icon md-icon"></span>
            
  
    Scicat
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../reference/scicat/scicat_interface/">
<span class="md-ellipsis">
    
  
    Scicat interface
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../reference/scicat/scicat_tasks/">
<span class="md-ellipsis">
    
  
    Scicat tasks
  

    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_5_5" type="checkbox"/>
<label class="md-nav__link" for="__nav_5_5" id="__nav_5_5_label" tabindex="0">
<span class="md-ellipsis">
    
  
    Tests
  

    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_5_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_5_5">
<span class="md-nav__icon md-icon"></span>
            
  
    Tests
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../reference/tests/scicat_service_mock/">
<span class="md-ellipsis">
    
  
    Scicat service mock
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../reference/tests/test_e2e/">
<span class="md-ellipsis">
    
  
    Test e2e
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../reference/tests/test_scicat_tasks/">
<span class="md-ellipsis">
    
  
    Test scicat tasks
  

    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_5_6" type="checkbox"/>
<label class="md-nav__link" for="__nav_5_6" id="__nav_5_6_label" tabindex="0">
<span class="md-ellipsis">
    
  
    Utils
  

    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_6_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_5_6">
<span class="md-nav__icon md-icon"></span>
            
  
    Utils
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../reference/utils/datablocks/">
<span class="md-ellipsis">
    
  
    Datablocks
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../reference/utils/log/">
<span class="md-ellipsis">
    
  
    Log
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../reference/utils/model/">
<span class="md-ellipsis">
    
  
    Model
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../reference/utils/s3_storage_interface/">
<span class="md-ellipsis">
    
  
    S3 storage interface
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../reference/utils/script_generation/">
<span class="md-ellipsis">
    
  
    Script generation
  

    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_5_6_6" type="checkbox"/>
<label class="md-nav__link" for="__nav_5_6_6" id="__nav_5_6_6_label" tabindex="0">
<span class="md-ellipsis">
    
  
    Tests
  

    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_6_6_label" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_5_6_6">
<span class="md-nav__icon md-icon"></span>
            
  
    Tests
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../reference/utils/tests/test_datablocks/">
<span class="md-ellipsis">
    
  
    Test datablocks
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../reference/utils/tests/test_s3/">
<span class="md-ellipsis">
    
  
    Test s3
  

    
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<h1 id="architecture">Architecture</h1>
<h2 id="component-diagram">Component Diagram</h2>
<p><div class="mxgraph" data-mxgraph='{"toolbar-position": "bottom", "toolbar-nohide": "0", "tooltips": "1", "border": 5, "resize": "1", "edit": "_blank", "lightbox": "1", "toolbar": "pages tags zoom layers lightbox", "xml": "&lt;mxfile host=\"65bd71144e\"&gt;\n    &lt;diagram id=\"yUpXesffEtbtTizqdA8Y\" name=\"Page-1\"&gt;\n        &lt;mxGraphModel dx=\"917\" dy=\"548\" grid=\"1\" gridSize=\"10\" guides=\"1\" tooltips=\"1\" connect=\"1\" arrows=\"1\" fold=\"1\" page=\"1\" pageScale=\"1\" pageWidth=\"850\" pageHeight=\"1100\" math=\"0\" shadow=\"0\"&gt;\n            &lt;root&gt;\n                &lt;mxCell id=\"0\"/&gt;\n                &lt;mxCell id=\"1\" parent=\"0\"/&gt;\n                &lt;mxCell id=\"69\" value=\"\" style=\"group\" parent=\"1\" vertex=\"1\" connectable=\"0\"&gt;\n                    &lt;mxGeometry x=\"740\" y=\"40\" width=\"800\" height=\"640\" as=\"geometry\"/&gt;\n                &lt;/mxCell&gt;\n                &lt;mxCell id=\"67\" value=\"\u00abSubsystem\u00bb&amp;lt;br&amp;gt;&amp;lt;b&amp;gt;Archiver Service&amp;lt;/b&amp;gt;\" style=\"html=1;dropTarget=0;align=center;labelPosition=center;verticalLabelPosition=top;verticalAlign=bottom;\" parent=\"69\" vertex=\"1\"&gt;\n                    &lt;mxGeometry width=\"800\" height=\"640\" as=\"geometry\"/&gt;\n                &lt;/mxCell&gt;\n                &lt;mxCell id=\"68\" value=\"\" style=\"shape=module;jettyWidth=8;jettyHeight=4;\" parent=\"67\" vertex=\"1\"&gt;\n                    &lt;mxGeometry x=\"1\" width=\"20\" height=\"20\" relative=\"1\" as=\"geometry\"&gt;\n                        &lt;mxPoint x=\"-27\" y=\"7\" as=\"offset\"/&gt;\n                    &lt;/mxGeometry&gt;\n                &lt;/mxCell&gt;\n                &lt;mxCell id=\"27\" value=\"\u00abComponent\u00bb&amp;lt;br&amp;gt;&amp;lt;b&amp;gt;Archiver Service API&amp;lt;/b&amp;gt;\" style=\"html=1;dropTarget=0;\" parent=\"69\" vertex=\"1\"&gt;\n                    &lt;mxGeometry x=\"410.002857142857\" y=\"62\" width=\"329.1428571428571\" height=\"90\" as=\"geometry\"/&gt;\n                &lt;/mxCell&gt;\n                &lt;mxCell id=\"28\" value=\"\" style=\"shape=module;jettyWidth=8;jettyHeight=4;\" parent=\"27\" vertex=\"1\"&gt;\n                    &lt;mxGeometry x=\"1\" width=\"20\" height=\"20\" relative=\"1\" as=\"geometry\"&gt;\n                        &lt;mxPoint x=\"-27\" y=\"7\" as=\"offset\"/&gt;\n                    &lt;/mxGeometry&gt;\n                &lt;/mxCell&gt;\n                &lt;mxCell id=\"65\" value=\"\u00abComponent\u00bb&amp;lt;br&amp;gt;&amp;lt;b&amp;gt;Reverse Proxy&amp;lt;/b&amp;gt;\" style=\"html=1;dropTarget=0;\" parent=\"69\" vertex=\"1\"&gt;\n                    &lt;mxGeometry x=\"90\" y=\"72\" width=\"150\" height=\"500\" as=\"geometry\"/&gt;\n                &lt;/mxCell&gt;\n                &lt;mxCell id=\"66\" value=\"\" style=\"shape=module;jettyWidth=8;jettyHeight=4;\" parent=\"65\" vertex=\"1\"&gt;\n                    &lt;mxGeometry x=\"1\" width=\"20\" height=\"20\" relative=\"1\" as=\"geometry\"&gt;\n                        &lt;mxPoint x=\"-27\" y=\"7\" as=\"offset\"/&gt;\n                    &lt;/mxGeometry&gt;\n                &lt;/mxCell&gt;\n                &lt;mxCell id=\"81\" value=\"\" style=\"edgeStyle=elbowEdgeStyle;elbow=horizontal;endArrow=open;html=1;curved=0;rounded=0;endSize=8;startSize=8;entryX=0;entryY=0.5;entryDx=0;entryDy=0;dashed=1;exitX=1;exitY=0.25;exitDx=0;exitDy=0;endFill=0;\" parent=\"69\" source=\"65\" target=\"27\" edge=\"1\"&gt;\n                    &lt;mxGeometry width=\"50\" height=\"50\" relative=\"1\" as=\"geometry\"&gt;\n                        &lt;mxPoint x=\"290.42428571428536\" y=\"90\" as=\"sourcePoint\"/&gt;\n                        &lt;mxPoint x=\"290\" y=\"258\" as=\"targetPoint\"/&gt;\n                        &lt;Array as=\"points\"&gt;\n                            &lt;mxPoint x=\"310\" y=\"130\"/&gt;\n                            &lt;mxPoint x=\"565\" y=\"148\"/&gt;\n                        &lt;/Array&gt;\n                    &lt;/mxGeometry&gt;\n                &lt;/mxCell&gt;\n                &lt;mxCell id=\"97\" value=\"\" style=\"group\" parent=\"69\" vertex=\"1\" connectable=\"0\"&gt;\n                    &lt;mxGeometry x=\"409.1500000000001\" y=\"190\" width=\"330\" height=\"410\" as=\"geometry\"/&gt;\n                &lt;/mxCell&gt;\n                &lt;mxCell id=\"93\" value=\"&amp;lt;div style=&amp;quot;text-align: center;&amp;quot;&amp;gt;&amp;lt;span style=&amp;quot;background-color: initial;&amp;quot;&amp;gt;\u00abSubsystem\u00bb&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;b&amp;gt;Workflow Orchestration&amp;lt;/b&amp;gt;\" style=\"html=1;dropTarget=0;labelPosition=center;verticalLabelPosition=top;align=center;verticalAlign=bottom;\" parent=\"97\" vertex=\"1\"&gt;\n                    &lt;mxGeometry width=\"330\" height=\"410\" as=\"geometry\"/&gt;\n                &lt;/mxCell&gt;\n                &lt;mxCell id=\"94\" value=\"\" style=\"shape=module;jettyWidth=8;jettyHeight=4;\" parent=\"93\" vertex=\"1\"&gt;\n                    &lt;mxGeometry x=\"1\" width=\"20\" height=\"20\" relative=\"1\" as=\"geometry\"&gt;\n                        &lt;mxPoint x=\"-27\" y=\"7\" as=\"offset\"/&gt;\n                    &lt;/mxGeometry&gt;\n                &lt;/mxCell&gt;\n                &lt;mxCell id=\"23\" value=\"\u00abComponent\u00bb&amp;lt;br&amp;gt;&amp;lt;b&amp;gt;Prefect Server&amp;lt;/b&amp;gt;\" style=\"html=1;dropTarget=0;\" parent=\"97\" vertex=\"1\"&gt;\n                    &lt;mxGeometry x=\"37\" y=\"40\" width=\"260\" height=\"88\" as=\"geometry\"/&gt;\n                &lt;/mxCell&gt;\n                &lt;mxCell id=\"24\" value=\"\" style=\"shape=module;jettyWidth=8;jettyHeight=4;\" parent=\"23\" vertex=\"1\"&gt;\n                    &lt;mxGeometry x=\"1\" width=\"20\" height=\"20\" relative=\"1\" as=\"geometry\"&gt;\n                        &lt;mxPoint x=\"-27\" y=\"7\" as=\"offset\"/&gt;\n                    &lt;/mxGeometry&gt;\n                &lt;/mxCell&gt;\n                &lt;mxCell id=\"12\" value=\"\u00abComponent\u00bb&amp;lt;br&amp;gt;&amp;lt;b&amp;gt;Prefect Worker&amp;lt;/b&amp;gt;\" style=\"html=1;dropTarget=0;\" parent=\"97\" vertex=\"1\"&gt;\n                    &lt;mxGeometry x=\"37\" y=\"170\" width=\"260\" height=\"80\" as=\"geometry\"/&gt;\n                &lt;/mxCell&gt;\n                &lt;mxCell id=\"13\" value=\"\" style=\"shape=module;jettyWidth=8;jettyHeight=4;\" parent=\"12\" vertex=\"1\"&gt;\n                    &lt;mxGeometry x=\"1\" width=\"20\" height=\"20\" relative=\"1\" as=\"geometry\"&gt;\n                        &lt;mxPoint x=\"-27\" y=\"7\" as=\"offset\"/&gt;\n                    &lt;/mxGeometry&gt;\n                &lt;/mxCell&gt;\n                &lt;mxCell id=\"14\" value=\"\u00abComponent\u00bb&amp;lt;br&amp;gt;&amp;lt;b&amp;gt;Prefect Flow&amp;lt;/b&amp;gt;\" style=\"html=1;dropTarget=0;\" parent=\"97\" vertex=\"1\"&gt;\n                    &lt;mxGeometry x=\"37\" y=\"295\" width=\"259.57\" height=\"80\" as=\"geometry\"/&gt;\n                &lt;/mxCell&gt;\n                &lt;mxCell id=\"15\" value=\"\" style=\"shape=module;jettyWidth=8;jettyHeight=4;\" parent=\"14\" vertex=\"1\"&gt;\n                    &lt;mxGeometry x=\"1\" width=\"20\" height=\"20\" relative=\"1\" as=\"geometry\"&gt;\n                        &lt;mxPoint x=\"-27\" y=\"7\" as=\"offset\"/&gt;\n                    &lt;/mxGeometry&gt;\n                &lt;/mxCell&gt;\n                &lt;mxCell id=\"89\" value=\"Queue Flow\" style=\"endArrow=open;endSize=12;dashed=1;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;\" parent=\"97\" source=\"23\" target=\"12\" edge=\"1\"&gt;\n                    &lt;mxGeometry width=\"160\" relative=\"1\" as=\"geometry\"&gt;\n                        &lt;mxPoint x=\"1314.4342857142856\" y=\"342\" as=\"sourcePoint\"/&gt;\n                        &lt;mxPoint x=\"1314.4342857142856\" y=\"402\" as=\"targetPoint\"/&gt;\n                    &lt;/mxGeometry&gt;\n                &lt;/mxCell&gt;\n                &lt;mxCell id=\"92\" value=\"Read Variables&amp;lt;br&amp;gt;and Secrets\" style=\"endArrow=open;endSize=12;dashed=1;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;\" parent=\"97\" source=\"14\" target=\"23\" edge=\"1\"&gt;\n                    &lt;mxGeometry width=\"160\" relative=\"1\" as=\"geometry\"&gt;\n                        &lt;mxPoint x=\"1324.4342857142856\" y=\"352\" as=\"sourcePoint\"/&gt;\n                        &lt;mxPoint x=\"1324.5742857142855\" y=\"410\" as=\"targetPoint\"/&gt;\n                        &lt;Array as=\"points\"&gt;\n                            &lt;mxPoint x=\"10.849999999999909\" y=\"330\"/&gt;\n                            &lt;mxPoint x=\"10.849999999999909\" y=\"240\"/&gt;\n                            &lt;mxPoint x=\"10.849999999999909\" y=\"84\"/&gt;\n                        &lt;/Array&gt;\n                    &lt;/mxGeometry&gt;\n                &lt;/mxCell&gt;\n                &lt;mxCell id=\"91\" value=\"Run Flow\" style=\"endArrow=open;endSize=12;dashed=1;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;\" parent=\"97\" source=\"12\" target=\"14\" edge=\"1\"&gt;\n                    &lt;mxGeometry width=\"160\" relative=\"1\" as=\"geometry\"&gt;\n                        &lt;mxPoint x=\"1314.4342857142856\" y=\"492\" as=\"sourcePoint\"/&gt;\n                        &lt;mxPoint x=\"1314.5742857142857\" y=\"550\" as=\"targetPoint\"/&gt;\n                    &lt;/mxGeometry&gt;\n                &lt;/mxCell&gt;\n                &lt;mxCell id=\"88\" value=\"Schedule Flow\" style=\"endArrow=open;endSize=12;dashed=1;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;\" parent=\"69\" source=\"27\" target=\"23\" edge=\"1\"&gt;\n                    &lt;mxGeometry width=\"160\" relative=\"1\" as=\"geometry\"&gt;\n                        &lt;mxPoint x=\"570\" y=\"170\" as=\"sourcePoint\"/&gt;\n                        &lt;mxPoint x=\"730\" y=\"170\" as=\"targetPoint\"/&gt;\n                    &lt;/mxGeometry&gt;\n                &lt;/mxCell&gt;\n                &lt;mxCell id=\"32\" value=\"\" style=\"group\" parent=\"1\" vertex=\"1\" connectable=\"0\"&gt;\n                    &lt;mxGeometry x=\"319\" y=\"470\" width=\"250\" height=\"160\" as=\"geometry\"/&gt;\n                &lt;/mxCell&gt;\n                &lt;mxCell id=\"40\" value=\"\" style=\"group\" parent=\"32\" vertex=\"1\" connectable=\"0\"&gt;\n                    &lt;mxGeometry width=\"250\" height=\"160\" as=\"geometry\"/&gt;\n                &lt;/mxCell&gt;\n                &lt;mxCell id=\"34\" value=\"\u00abComponent\u00bb&amp;lt;br&amp;gt;&amp;lt;b&amp;gt;Scicat Backend&amp;lt;/b&amp;gt;\" style=\"html=1;dropTarget=0;\" parent=\"40\" vertex=\"1\"&gt;\n                    &lt;mxGeometry x=\"35\" y=\"50\" width=\"180\" height=\"90\" as=\"geometry\"/&gt;\n                &lt;/mxCell&gt;\n                &lt;mxCell id=\"35\" value=\"\" style=\"shape=module;jettyWidth=8;jettyHeight=4;\" parent=\"34\" vertex=\"1\"&gt;\n                    &lt;mxGeometry x=\"1\" width=\"20\" height=\"20\" relative=\"1\" as=\"geometry\"&gt;\n                        &lt;mxPoint x=\"-27\" y=\"7\" as=\"offset\"/&gt;\n                    &lt;/mxGeometry&gt;\n                &lt;/mxCell&gt;\n                &lt;mxCell id=\"36\" value=\"\" style=\"group\" parent=\"1\" vertex=\"1\" connectable=\"0\"&gt;\n                    &lt;mxGeometry x=\"1190\" y=\"740\" width=\"250\" height=\"160\" as=\"geometry\"/&gt;\n                &lt;/mxCell&gt;\n                &lt;mxCell id=\"38\" value=\"\u00abComponent\u00bb&amp;lt;br&amp;gt;&amp;lt;b&amp;gt;Storage Server&amp;lt;/b&amp;gt;\" style=\"html=1;dropTarget=0;\" parent=\"36\" vertex=\"1\"&gt;\n                    &lt;mxGeometry x=\"35\" y=\"50\" width=\"180\" height=\"90\" as=\"geometry\"/&gt;\n                &lt;/mxCell&gt;\n                &lt;mxCell id=\"39\" value=\"\" style=\"shape=module;jettyWidth=8;jettyHeight=4;\" parent=\"38\" vertex=\"1\"&gt;\n                    &lt;mxGeometry x=\"1\" width=\"20\" height=\"20\" relative=\"1\" as=\"geometry\"&gt;\n                        &lt;mxPoint x=\"-27\" y=\"7\" as=\"offset\"/&gt;\n                    &lt;/mxGeometry&gt;\n                &lt;/mxCell&gt;\n                &lt;mxCell id=\"44\" value=\"\" style=\"group\" parent=\"1\" vertex=\"1\" connectable=\"0\"&gt;\n                    &lt;mxGeometry x=\"450\" y=\"741\" width=\"250\" height=\"160\" as=\"geometry\"/&gt;\n                &lt;/mxCell&gt;\n                &lt;mxCell id=\"46\" value=\"\u00abComponent\u00bb&amp;lt;br&amp;gt;&amp;lt;b&amp;gt;Ingestor&amp;lt;/b&amp;gt;\" style=\"html=1;dropTarget=0;\" parent=\"44\" vertex=\"1\"&gt;\n                    &lt;mxGeometry x=\"35\" y=\"50\" width=\"180\" height=\"90\" as=\"geometry\"/&gt;\n                &lt;/mxCell&gt;\n                &lt;mxCell id=\"47\" value=\"\" style=\"shape=module;jettyWidth=8;jettyHeight=4;\" parent=\"46\" vertex=\"1\"&gt;\n                    &lt;mxGeometry x=\"1\" width=\"20\" height=\"20\" relative=\"1\" as=\"geometry\"&gt;\n                        &lt;mxPoint x=\"-27\" y=\"7\" as=\"offset\"/&gt;\n                    &lt;/mxGeometry&gt;\n                &lt;/mxCell&gt;\n                &lt;mxCell id=\"48\" value=\"\" style=\"edgeStyle=elbowEdgeStyle;elbow=horizontal;endArrow=open;html=1;curved=0;rounded=0;endSize=8;startSize=8;entryX=0.5;entryY=0;entryDx=0;entryDy=0;dashed=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;endFill=0;\" parent=\"1\" source=\"14\" target=\"38\" edge=\"1\"&gt;\n                    &lt;mxGeometry width=\"50\" height=\"50\" relative=\"1\" as=\"geometry\"&gt;\n                        &lt;mxPoint x=\"1290\" y=\"710\" as=\"sourcePoint\"/&gt;\n                        &lt;mxPoint x=\"1320\" y=\"640\" as=\"targetPoint\"/&gt;\n                        &lt;Array as=\"points\"&gt;\n                            &lt;mxPoint x=\"1315\" y=\"720\"/&gt;\n                            &lt;mxPoint x=\"1590\" y=\"680\"/&gt;\n                        &lt;/Array&gt;\n                    &lt;/mxGeometry&gt;\n                &lt;/mxCell&gt;\n                &lt;mxCell id=\"83\" value=\"Store Datasets&amp;lt;br&amp;gt;using S3\" style=\"edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];\" parent=\"48\" vertex=\"1\" connectable=\"0\"&gt;\n                    &lt;mxGeometry x=\"-0.0212\" relative=\"1\" as=\"geometry\"&gt;\n                        &lt;mxPoint as=\"offset\"/&gt;\n                    &lt;/mxGeometry&gt;\n                &lt;/mxCell&gt;\n                &lt;mxCell id=\"50\" value=\"\" style=\"edgeStyle=elbowEdgeStyle;elbow=horizontal;endArrow=open;html=1;curved=0;rounded=0;endSize=8;startSize=8;entryX=0;entryY=0.5;entryDx=0;entryDy=0;dashed=1;jumpStyle=gap;startArrow=none;exitX=1;exitY=0.5;exitDx=0;exitDy=0;endFill=0;\" parent=\"1\" source=\"46\" target=\"38\" edge=\"1\"&gt;\n                    &lt;mxGeometry width=\"50\" height=\"50\" relative=\"1\" as=\"geometry\"&gt;\n                        &lt;mxPoint x=\"1560\" y=\"850\" as=\"sourcePoint\"/&gt;\n                        &lt;mxPoint x=\"1205\" y=\"395\" as=\"targetPoint\"/&gt;\n                        &lt;Array as=\"points\"&gt;\n                            &lt;mxPoint x=\"980\" y=\"880\"/&gt;\n                        &lt;/Array&gt;\n                    &lt;/mxGeometry&gt;\n                &lt;/mxCell&gt;\n                &lt;mxCell id=\"82\" value=\"Upload Datasets&amp;lt;br&amp;gt;using S3\" style=\"edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];\" parent=\"50\" vertex=\"1\" connectable=\"0\"&gt;\n                    &lt;mxGeometry x=\"0.3281\" relative=\"1\" as=\"geometry\"&gt;\n                        &lt;mxPoint as=\"offset\"/&gt;\n                    &lt;/mxGeometry&gt;\n                &lt;/mxCell&gt;\n                &lt;mxCell id=\"51\" value=\"\" style=\"edgeStyle=elbowEdgeStyle;elbow=horizontal;endArrow=open;html=1;curved=0;rounded=0;endSize=8;startSize=8;exitX=0;exitY=0.5;exitDx=0;exitDy=0;dashed=1;entryX=0.5;entryY=1;entryDx=0;entryDy=0;endFill=0;\" parent=\"1\" source=\"46\" target=\"34\" edge=\"1\"&gt;\n                    &lt;mxGeometry width=\"50\" height=\"50\" relative=\"1\" as=\"geometry\"&gt;\n                        &lt;mxPoint x=\"1015\" y=\"882.5\" as=\"sourcePoint\"/&gt;\n                        &lt;mxPoint x=\"230\" y=\"710\" as=\"targetPoint\"/&gt;\n                        &lt;Array as=\"points\"&gt;\n                            &lt;mxPoint x=\"444\" y=\"730\"/&gt;\n                        &lt;/Array&gt;\n                    &lt;/mxGeometry&gt;\n                &lt;/mxCell&gt;\n                &lt;mxCell id=\"85\" value=\"Ingest Datasets\" style=\"edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];\" parent=\"51\" vertex=\"1\" connectable=\"0\"&gt;\n                    &lt;mxGeometry x=\"0.4679\" y=\"3\" relative=\"1\" as=\"geometry\"&gt;\n                        &lt;mxPoint as=\"offset\"/&gt;\n                    &lt;/mxGeometry&gt;\n                &lt;/mxCell&gt;\n                &lt;mxCell id=\"54\" value=\"\" style=\"rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;sketch=0;targetPerimeterSpacing=0;dashed=1;fontFamily=Helvetica;fontSize=11;fontColor=default;align=center;startSize=8;endSize=8;strokeColor=default;edgeStyle=elbowEdgeStyle;elbow=horizontal;startArrow=none;\" parent=\"1\" source=\"64\" target=\"34\" edge=\"1\"&gt;\n                    &lt;mxGeometry width=\"50\" height=\"50\" relative=\"1\" as=\"geometry\"&gt;\n                        &lt;mxPoint x=\"1015\" y=\"882.5\" as=\"sourcePoint\"/&gt;\n                        &lt;mxPoint x=\"1205\" y=\"395\" as=\"targetPoint\"/&gt;\n                        &lt;Array as=\"points\"/&gt;\n                    &lt;/mxGeometry&gt;\n                &lt;/mxCell&gt;\n                &lt;mxCell id=\"57\" value=\"\" style=\"rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;sketch=0;sourcePerimeterSpacing=0;targetPerimeterSpacing=0;dashed=1;jumpStyle=arc;exitX=0.5;exitY=0;exitDx=0;exitDy=0;\" parent=\"1\" source=\"34\" target=\"59\" edge=\"1\"&gt;\n                    &lt;mxGeometry relative=\"1\" as=\"geometry\"&gt;\n                        &lt;mxPoint x=\"620\" y=\"265\" as=\"sourcePoint\"/&gt;\n                    &lt;/mxGeometry&gt;\n                &lt;/mxCell&gt;\n                &lt;mxCell id=\"86\" value=\"Schedule Archival/Retrieval Job\" style=\"edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];\" parent=\"57\" vertex=\"1\" connectable=\"0\"&gt;\n                    &lt;mxGeometry x=\"0.1981\" y=\"2\" relative=\"1\" as=\"geometry\"&gt;\n                        &lt;mxPoint as=\"offset\"/&gt;\n                    &lt;/mxGeometry&gt;\n                &lt;/mxCell&gt;\n                &lt;mxCell id=\"63\" value=\"\" style=\"rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;sketch=0;sourcePerimeterSpacing=0;dashed=1;fontFamily=Helvetica;fontSize=11;fontColor=default;align=center;startSize=8;endSize=8;strokeColor=default;edgeStyle=elbowEdgeStyle;elbow=horizontal;exitX=0.25;exitY=1;exitDx=0;exitDy=0;\" parent=\"1\" source=\"14\" target=\"64\" edge=\"1\"&gt;\n                    &lt;mxGeometry width=\"50\" height=\"50\" relative=\"1\" as=\"geometry\"&gt;\n                        &lt;mxPoint x=\"825\" y=\"895\" as=\"sourcePoint\"/&gt;\n                        &lt;mxPoint x=\"335\" y=\"565\" as=\"targetPoint\"/&gt;\n                        &lt;Array as=\"points\"&gt;\n                            &lt;mxPoint x=\"1010\" y=\"720\"/&gt;\n                        &lt;/Array&gt;\n                    &lt;/mxGeometry&gt;\n                &lt;/mxCell&gt;\n                &lt;mxCell id=\"87\" value=\"Update Job/Dataset Status\" style=\"edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];\" parent=\"63\" vertex=\"1\" connectable=\"0\"&gt;\n                    &lt;mxGeometry x=\"0.0271\" y=\"1\" relative=\"1\" as=\"geometry\"&gt;\n                        &lt;mxPoint as=\"offset\"/&gt;\n                    &lt;/mxGeometry&gt;\n                &lt;/mxCell&gt;\n                &lt;mxCell id=\"64\" value=\"Scicat Jobs&amp;lt;br&amp;gt;Scicat Dataset\" style=\"shape=providedRequiredInterface;html=1;verticalLabelPosition=bottom;sketch=0;flipV=1;flipH=1;\" parent=\"1\" vertex=\"1\"&gt;\n                    &lt;mxGeometry x=\"650\" y=\"555\" width=\"20\" height=\"20\" as=\"geometry\"/&gt;\n                &lt;/mxCell&gt;\n                &lt;mxCell id=\"29\" value=\"\u00abComponent\u00bb&amp;lt;br&amp;gt;&amp;lt;b&amp;gt;LTS Share&amp;lt;/b&amp;gt;\" style=\"html=1;dropTarget=0;\" parent=\"1\" vertex=\"1\"&gt;\n                    &lt;mxGeometry x=\"1623\" y=\"700\" width=\"180\" height=\"90\" as=\"geometry\"/&gt;\n                &lt;/mxCell&gt;\n                &lt;mxCell id=\"30\" value=\"\" style=\"shape=module;jettyWidth=8;jettyHeight=4;\" parent=\"29\" vertex=\"1\"&gt;\n                    &lt;mxGeometry x=\"1\" width=\"20\" height=\"20\" relative=\"1\" as=\"geometry\"&gt;\n                        &lt;mxPoint x=\"-27\" y=\"7\" as=\"offset\"/&gt;\n                    &lt;/mxGeometry&gt;\n                &lt;/mxCell&gt;\n                &lt;mxCell id=\"49\" value=\"\" style=\"edgeStyle=elbowEdgeStyle;elbow=horizontal;endArrow=open;html=1;curved=0;rounded=0;endSize=8;startSize=8;entryX=0;entryY=0.5;entryDx=0;entryDy=0;exitX=0.75;exitY=1;exitDx=0;exitDy=0;dashed=1;jumpStyle=arc;startArrow=none;startFill=0;endFill=0;\" parent=\"1\" source=\"14\" target=\"29\" edge=\"1\"&gt;\n                    &lt;mxGeometry width=\"50\" height=\"50\" relative=\"1\" as=\"geometry\"&gt;\n                        &lt;mxPoint x=\"1015\" y=\"882.5\" as=\"sourcePoint\"/&gt;\n                        &lt;mxPoint x=\"1205\" y=\"395\" as=\"targetPoint\"/&gt;\n                        &lt;Array as=\"points\"&gt;\n                            &lt;mxPoint x=\"1398\" y=\"680\"/&gt;\n                        &lt;/Array&gt;\n                    &lt;/mxGeometry&gt;\n                &lt;/mxCell&gt;\n                &lt;mxCell id=\"84\" value=\"Archive/Retreive Datasets\" style=\"edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];\" parent=\"49\" vertex=\"1\" connectable=\"0\"&gt;\n                    &lt;mxGeometry x=\"0.1808\" y=\"2\" relative=\"1\" as=\"geometry\"&gt;\n                        &lt;mxPoint as=\"offset\"/&gt;\n                    &lt;/mxGeometry&gt;\n                &lt;/mxCell&gt;\n                &lt;mxCell id=\"58\" value=\"\" style=\"rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;sketch=0;sourcePerimeterSpacing=0;targetPerimeterSpacing=0;dashed=1;fontFamily=Helvetica;fontSize=11;fontColor=default;align=center;endSize=6;strokeColor=default;strokeWidth=1;entryX=0;entryY=0.25;entryDx=0;entryDy=0;\" parent=\"1\" source=\"59\" target=\"65\" edge=\"1\"&gt;\n                    &lt;mxGeometry relative=\"1\" as=\"geometry\"&gt;\n                        &lt;mxPoint x=\"829\" y=\"238\" as=\"sourcePoint\"/&gt;\n                        &lt;mxPoint x=\"640\" y=\"210\" as=\"targetPoint\"/&gt;\n                    &lt;/mxGeometry&gt;\n                &lt;/mxCell&gt;\n                &lt;mxCell id=\"80\" value=\"Job\" style=\"edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];\" parent=\"58\" vertex=\"1\" connectable=\"0\"&gt;\n                    &lt;mxGeometry x=\"-0.6677\" relative=\"1\" as=\"geometry\"&gt;\n                        &lt;mxPoint as=\"offset\"/&gt;\n                    &lt;/mxGeometry&gt;\n                &lt;/mxCell&gt;\n                &lt;object label=\"J\" id=\"59\"&gt;\n                    &lt;mxCell style=\"ellipse;whiteSpace=wrap;html=1;align=center;aspect=fixed;resizable=0;points=[];outlineConnect=0;sketch=0;\" parent=\"1\" vertex=\"1\"&gt;\n                        &lt;mxGeometry x=\"600\" y=\"230\" width=\"10\" height=\"10\" as=\"geometry\"/&gt;\n                    &lt;/mxCell&gt;\n                &lt;/object&gt;\n            &lt;/root&gt;\n        &lt;/mxGraphModel&gt;\n    &lt;/diagram&gt;\n&lt;/mxfile&gt;"}' style="max-width:100%;border:1px solid transparent;"></div></p>
<h3 id="components">Components</h3>
<h4 id="archiver-service">Archiver Service</h4>
<table>
<thead>
<tr>
<th>Name</th>
<th>Technology</th>
<th>Description</th>
<th>Endpoint</th>
</tr>
</thead>
<tbody>
<tr>
<td>Reverse Proxy</td>
<td>Traefik <a href="https://traefik.io/traefik/">https://traefik.io/traefik/</a></td>
<td>Routes traffic to endpoints</td>
<td><a href="https://${HOST}/dashboard/">https://${HOST}/dashboard/</a></td>
</tr>
<tr>
<td>Backend Api</td>
<td>FastAPI <a href="https://fastapi.tiangolo.com">https://fastapi.tiangolo.com</a></td>
<td>Endpoint for Scicat backend, requests flow scheduling by Prefect</td>
<td><a href="https://${HOST}/archiver/api/v1/docs">https://${HOST}/archiver/api/v1/docs</a></td>
</tr>
<tr>
<td>Workflow Orchestraction</td>
<td>Prefect <a href="https://www.prefect.io">https://www.prefect.io</a></td>
<td>Orchestrates workflows for archival and retrieval operations</td>
<td><a href="https://${HOST}/archiver/prefect/ui/dashboard">https://${HOST}/archiver/prefect/ui/dashboard</a></td>
</tr>
</tbody>
</table>
<h4 id="workflow-orchestration">Workflow Orchestration</h4>
<table>
<thead>
<tr>
<th>Name</th>
<th>Technology</th>
<th>Description</th>
<th>Endpoint</th>
</tr>
</thead>
<tbody>
<tr>
<td>Prefect Server</td>
<td><a href="https://docs.prefect.io/3.0/manage/self-host">https://docs.prefect.io/3.0/manage/self-host</a></td>
<td></td>
<td><a href="https://${HOST}/archiver/prefect/ui/dashboard">https://${HOST}/archiver/prefect/ui/dashboard</a></td>
</tr>
<tr>
<td>Prefect Worker</td>
<td><a href="https://docs.prefect.io/3.0/deploy/infrastructure-concepts/workers">https://docs.prefect.io/3.0/deploy/infrastructure-concepts/workers</a></td>
<td></td>
<td>n/a</td>
</tr>
<tr>
<td>Prefect Flow</td>
<td><a href="https://docs.prefect.io/3.0/develop/write-flows#write-and-run-flows">https://docs.prefect.io/3.0/develop/write-flows#write-and-run-flows</a></td>
<td></td>
<td>n/a</td>
</tr>
</tbody>
</table>
<h4 id="storage-components">Storage Components</h4>
<table>
<thead>
<tr>
<th>Name</th>
<th>Technology</th>
<th>Description</th>
<th>Endpoint</th>
</tr>
</thead>
<tbody>
<tr>
<td>Storage Server</td>
<td>Minio <a href="https://min.io">https://min.io</a></td>
<td>Storage for datasets that are to be archived or are retrievable</td>
<td><a href="http://localhost/minio/">http://localhost/minio/</a></td>
</tr>
<tr>
<td>LTS Share</td>
<td>NFS Network share</td>
<td>ETHZ Long term storage where datasets are stored on and retrieved from</td>
<td>n/a</td>
</tr>
</tbody>
</table>
<h4 id="external-components">External Components</h4>
<table>
<thead>
<tr>
<th>Name</th>
<th>Technology</th>
<th>Description</th>
<th>Endpoint</th>
</tr>
</thead>
<tbody>
<tr>
<td>Ingestor</td>
<td>Golang <a href="https://github.com/SwissOpenEM/Ingestor">https://github.com/SwissOpenEM/Ingestor</a></td>
<td>Client application to select, ingest, and upload datasets</td>
<td>n/a</td>
</tr>
<tr>
<td>SciCat Frontend</td>
<td>Node.js <a href="https://scicatproject.github.io">https://scicatproject.github.io</a></td>
<td>Data catalog frontend where datasets are registered and archival/retrieval is triggered</td>
<td><a href="https://discovery.psi.ch/">https://discovery.psi.ch/</a>, <a href="https://${HOST}/">https://${HOST}/</a></td>
</tr>
<tr>
<td>SciCat Backend</td>
<td>Node.js <a href="https://scicatproject.github.io">https://scicatproject.github.io</a></td>
<td>Data catalog backend where datasets are registered and archival/retrieval is triggered</td>
<td><a href="https://dacat.psi.ch/explorer/">https://dacat.psi.ch/explorer/</a>, <a href="https://${HOST}/scicat/backend/explorer">https://${HOST}/scicat/backend/explorer</a></td>
</tr>
</tbody>
</table>
<h2 id="authentication">Authentication</h2>
<p>Certain service pages do not support standard OAuth2/OIDC authentication mechanism, such as:</p>
<ul>
<li>Traefik dashboard</li>
<li>MinIO admin login</li>
<li>Grafana monitoring dashboard</li>
</ul>
<p>To protect these pages, we use a proxy technology called <strong>Forward Auth</strong>. To achieve this, we need to configure the following:</p>
<ul>
<li>we need to tell Traefik to act as a <strong>reverse proxy</strong> to logically protect certain webpages</li>
<li>we do this by registering a so called <strong>middleware</strong> in traefik</li>
<li>this middleware will be of type <a href="https://doc.traefik.io/traefik/middlewares/http/forwardauth/">forwardauth</a> and redirects to a service called <strong>authentik-proxy</strong>, e.g. <code>traefik.http.middlewares.authentik.forwardauth.address: http://authentik-proxy:9000/outpost.goauthentik.io/auth/traefik</code></li>
<li><code>authentik-proxy</code> service integrates with Traefik's reverse proxy and acts as a <strong>authentication gateway</strong> to Authentik's <strong>outpost</strong></li>
<li>an outpost in Authentik is a deployment that acts as a bridge between Authentik and external services, handling authentication and authorization. </li>
<li>in Authentik (our identity broker) we need to register</li>
<li><strong>Application</strong>: basically a name and a URL where the application can be found. It is onnected to one provider</li>
<li><strong>Provider</strong>: the mechanism we use <em>how</em> to provide authentication and <em>source of the users</em>. For our use-case, we take a <strong>Proxy Provider</strong> of type <strong>Forward Auth</strong> at domain level, as all the service pages should be protected the same way. A provider can be connected to many applications.</li>
<li><strong>Outpost</strong>: an entity that talks to the Authentik-proxy service and provides a AUTHENTIK_TOKEN for that service. It is also connected to the provider. </li>
<li>for every service page that we would like to protect, we have to tell Traefik's router to use the <code>authentik</code> middleware defined earlier, e.g. <code>traefik.http.routers.dashboard.middlewares=authentik</code></li>
</ul>
<p>The following sequence diagram illustrates the authentication mechanism.</p>
<pre><div class="mermaid">
sequenceDiagram
  autonumber
  participant U as User Browser
  participant T as Traefik&lt;br/&gt;(reverse-proxy)
  participant S as Service Page
  participant O as authentik-proxy&lt;br/&gt;(outpost)
  participant AO as Authentik outpost
  participant AP as Authentik provider
  participant I as LDAP&lt;br/&gt;(identity provider)

  U -) T: request access to service page
  T -) T: is user authenticated (cookie )?
  T -) O: redirect to outpost
  O -) AO: redirect to authentication (AUTHENTIK_TOKEN )
  AO -) AP: redirect to login page
  AP -) U: ask for username
  U -) AP: enter username
  AP -) I: check username exists
  I -) AP: OK
  AP -) I: authorization: username is in allowed groups
  I -) AP: OK
  AP -) U: ask for password (plus OTP, if needed)
  U -) AP: enter password 
  AP -) I: check password 
  I -) AP: password OK
  AP -) O: redirect (cookie )
  O -) T: redirect (cookie )
  T -) S: access service page

  loop optional: sync users &amp; groups
     AP -) I: get users, groups
     I -) AP: users, groups
  end

</div></pre>
</article>
</div>
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"annotate": null, "base": "..", "features": ["toc.follow", "toc.integrate"], "search": "../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
<script src="../assets/javascripts/bundle.79ae519e.min.js"></script>
<script src="../assets/javascripts/panzoom.min.js"></script>
<script src="../assets/javascripts/zoompan.js"></script>
<script src="https://viewer.diagrams.net/js/viewer-static.min.js"></script><script type="module">import mermaid from "https://unpkg.com/mermaid@10.4.0/dist/mermaid.esm.min.mjs";
mermaid.initialize({});</script></body>
</html>