
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<link href="http://0.0.0.0:8000/" rel="canonical"/>
<link href="architecture/" rel="next"/>
<link href="assets/images/favicon.png" rel="icon"/>
<meta content="mkdocs-1.6.1, mkdocs-material-9.6.22" name="generator"/>
<title>ScopeMArchiver</title>
<link href="assets/stylesheets/main.84d31ad4.min.css" rel="stylesheet"/>
<link href="assets/stylesheets/palette.06af60db.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
<link href="assets/_mkdocstrings.css" rel="stylesheet"/>
<link href="assets/stylesheets/panzoom.css" rel="stylesheet"/>
<script>__md_scope=new URL(".",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
<meta name="panzoom-theme" content="material">
<meta name="panzoom-data" content='{"selectors": [".d2", ".mermaid"], "initial_zoom_level": 1.0}'> </head>
<body data-md-color-accent="indigo" data-md-color-primary="teal" data-md-color-scheme="default" dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#scopemarchiver">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header md-header--shadow" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="ScopeMArchiver" class="md-header__button md-logo" data-md-component="logo" href="." title="ScopeMArchiver">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            ScopeMArchiver
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              Introduction
            
          </span>
</div>
</div>
</div>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" title="Clear" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
</button>
</nav>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="" tabindex="0">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
<div class="md-header__source">
<a class="md-source" data-md-component="source" href="https://github.com/SwissOpenEM/ScopeMArchiver" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"></path></svg>
</div>
<div class="md-source__repository">
    SwissOpenEM/ScopeMArchiver
  </div>
</a>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary md-nav--integrated" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="ScopeMArchiver" class="md-nav__button md-logo" data-md-component="logo" href="." title="ScopeMArchiver">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg>
</a>
    ScopeMArchiver
  </label>
<div class="md-nav__source">
<a class="md-source" data-md-component="source" href="https://github.com/SwissOpenEM/ScopeMArchiver" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"></path></svg>
</div>
<div class="md-source__repository">
    SwissOpenEM/ScopeMArchiver
  </div>
</a>
</div>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
<span class="md-ellipsis">
    Introduction
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href=".">
<span class="md-ellipsis">
    Introduction
    
  </span>
</a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#quick-start">
<span class="md-ellipsis">
      Quick start
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#deploy-local-flows">
<span class="md-ellipsis">
      Deploy Local Flows
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#github-pages">
<span class="md-ellipsis">
      Github Pages
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#bulding-github-pages">
<span class="md-ellipsis">
      Bulding Github Pages
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#authentication-and-securing-of-dashboards">
<span class="md-ellipsis">
      Authentication and securing of dashboards
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="architecture/">
<span class="md-ellipsis">
    Architecture
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="deployment/">
<span class="md-ellipsis">
    Deployment
    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
<span class="md-ellipsis">
    Flows
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_4">
<span class="md-nav__icon md-icon"></span>
            Flows
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="upload_flow/">
<span class="md-ellipsis">
    Ingestion
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="archival_retrieval_flow/">
<span class="md-ellipsis">
    Archival and Retrieval
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_5" type="checkbox"/>
<label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
<span class="md-ellipsis">
    Code Reference
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_5">
<span class="md-nav__icon md-icon"></span>
            Code Reference
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="reference/Summary/">
<span class="md-ellipsis">
    Summary
    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_5_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_5_2" id="__nav_5_2_label" tabindex="0">
<span class="md-ellipsis">
    Config
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_2_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_5_2">
<span class="md-nav__icon md-icon"></span>
            Config
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="reference/config/blocks/">
<span class="md-ellipsis">
    Blocks
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="reference/config/concurrency_limits/">
<span class="md-ellipsis">
    Concurrency limits
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="reference/config/variables/">
<span class="md-ellipsis">
    Variables
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_5_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_5_3" id="__nav_5_3_label" tabindex="0">
<span class="md-ellipsis">
    Flows
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_3_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_5_3">
<span class="md-nav__icon md-icon"></span>
            Flows
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="reference/flows/archive_datasets_flow/">
<span class="md-ellipsis">
    Archive datasets flow
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="reference/flows/flow_utils/">
<span class="md-ellipsis">
    Flow utils
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="reference/flows/mock_flows/">
<span class="md-ellipsis">
    Mock flows
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="reference/flows/retrieve_datasets_flow/">
<span class="md-ellipsis">
    Retrieve datasets flow
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="reference/flows/task_utils/">
<span class="md-ellipsis">
    Task utils
    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_5_3_6" type="checkbox"/>
<label class="md-nav__link" for="__nav_5_3_6" id="__nav_5_3_6_label" tabindex="0">
<span class="md-ellipsis">
    Tests
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_3_6_label" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_5_3_6">
<span class="md-nav__icon md-icon"></span>
            Tests
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="reference/flows/tests/conftest/">
<span class="md-ellipsis">
    Conftest
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="reference/flows/tests/helpers/">
<span class="md-ellipsis">
    Helpers
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="reference/flows/tests/scicat_unittest_mock/">
<span class="md-ellipsis">
    Scicat unittest mock
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="reference/flows/tests/test_archival_flow/">
<span class="md-ellipsis">
    Test archival flow
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="reference/flows/tests/test_retrieval_flow/">
<span class="md-ellipsis">
    Test retrieval flow
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_5_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_5_4" id="__nav_5_4_label" tabindex="0">
<span class="md-ellipsis">
    Scicat
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_4_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_5_4">
<span class="md-nav__icon md-icon"></span>
            Scicat
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="reference/scicat/scicat_interface/">
<span class="md-ellipsis">
    Scicat interface
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="reference/scicat/scicat_tasks/">
<span class="md-ellipsis">
    Scicat tasks
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_5_5" type="checkbox"/>
<label class="md-nav__link" for="__nav_5_5" id="__nav_5_5_label" tabindex="0">
<span class="md-ellipsis">
    Tests
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_5_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_5_5">
<span class="md-nav__icon md-icon"></span>
            Tests
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="reference/tests/scicat_service_mock/">
<span class="md-ellipsis">
    Scicat service mock
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="reference/tests/test_e2e/">
<span class="md-ellipsis">
    Test e2e
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="reference/tests/test_scicat_tasks/">
<span class="md-ellipsis">
    Test scicat tasks
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_5_6" type="checkbox"/>
<label class="md-nav__link" for="__nav_5_6" id="__nav_5_6_label" tabindex="0">
<span class="md-ellipsis">
    Utils
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_6_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_5_6">
<span class="md-nav__icon md-icon"></span>
            Utils
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="reference/utils/datablocks/">
<span class="md-ellipsis">
    Datablocks
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="reference/utils/log/">
<span class="md-ellipsis">
    Log
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="reference/utils/model/">
<span class="md-ellipsis">
    Model
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="reference/utils/s3_storage_interface/">
<span class="md-ellipsis">
    S3 storage interface
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="reference/utils/script_generation/">
<span class="md-ellipsis">
    Script generation
    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_5_6_6" type="checkbox"/>
<label class="md-nav__link" for="__nav_5_6_6" id="__nav_5_6_6_label" tabindex="0">
<span class="md-ellipsis">
    Tests
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_6_6_label" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_5_6_6">
<span class="md-nav__icon md-icon"></span>
            Tests
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="reference/utils/tests/test_datablocks/">
<span class="md-ellipsis">
    Test datablocks
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="reference/utils/tests/test_s3/">
<span class="md-ellipsis">
    Test s3
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<h1 id="scopemarchiver">ScopeMArchiver</h1>
<p><a href="https://github.com/SwissOpenEM/ScopeMArchiver/actions/workflows/release.yml"><img alt="release" src="https://github.com/SwissOpenEM/ScopeMArchiver/actions/workflows/release.yml/badge.svg"/></a></p>
<p>An archiver service that allows uploading dataset and registering it with <a href="https://scicatproject.github.io">SciCat</a>. It is built on
<a href="prefect.io">Prefect.io</a> to orchestrate the asynchronous jobs (called flows) to archive and retrieve datasets to/from the ETH LTS.</p>
<p>The full setup is containerized and requires a SciCat instance to run correctly.</p>
<p>Refer to the <a href="#github-pages">Github pages</a> for more details.</p>
<h2 id="quick-start">Quick start</h2>
<p>Build all the services:</p>
<pre><code class="language-bash">docker compose --env-file .env.prod --env-file .env.development build
</code></pre>
<p>Starting up all services for development:</p>
<pre><code class="language-bash">docker compose --env-file .env.prod --env-file .env.development up -d
</code></pre>
<h2 id="deploy-local-flows">Deploy Local Flows</h2>
<p>For development and debugging, a local process can serve flows, for example by running <code>python -m archiver.flows</code>. However, some more configuration is required to fully integration with the other services; therefore a VS Code launch command <code>Prefect Flows</code> can be used in <a href="./backend/.vscode/launch.json">launch.json</a>). This allows to debug flows locally and the registered flows have a prefix, <code>DEV_</code>.</p>
<h2 id="github-pages">Github Pages</h2>
<p>The latest documentation can be found in the <a href="https://swissopenem.github.io/ScopeMArchiver/">GitHub Pages</a></p>
<h2 id="bulding-github-pages">Bulding Github Pages</h2>
<p>Github pages are built on <a href="https://hub.docker.com/r/squidfunk/mkdocs-material">mkdocs</a>.</p>
<p>Build docker image first:</p>
<pre><code class="language-bash">docker build . -f docs.Dockerfile -t ghcr.io/swissopenem/scopemarchiver-docs:latest
</code></pre>
<p>Start development server</p>
<pre><code class="language-bash">docker run --rm -it -p 8000:8000 -v ${PWD}:/docs ghcr.io/swissopenem/scopemarchiver-docs:latest
</code></pre>
<p>Build documentation</p>
<pre><code class="language-bash">docker run --rm -it -p 8000:8000 -v ${PWD}:/docs ghcr.io/swissopenem/scopemarchiver-docs:latest build
</code></pre>
<p>Deploy documentation to GitHub Pages</p>
<pre><code class="language-bash">docker run --rm -it -v ~/.ssh:/root/.ssh -v ${PWD}:/docs ghcr.io/swissopenem/scopemarchiver-docs:latest gh-deploy
</code></pre>
<h2 id="authentication-and-securing-of-dashboards">Authentication and securing of dashboards</h2>
<p>Certain service pages do not support standard OAuth2/OIDC authentication mechanism, such as:</p>
<ul>
<li>Traefik dashboard</li>
<li>MinIO admin login</li>
<li>Grafana monitoring dashboard</li>
</ul>
<p>To protect these pages, we use a proxy technology called <strong>Forward Auth</strong>. To achieve this, we need to configure the following:</p>
<ul>
<li>we need to tell Traefik to act as a <strong>reverse proxy</strong> to logically protect certain webpages</li>
<li>we do this by registering a so called <strong>middleware</strong> in traefik</li>
<li>this middleware will be of type <a href="https://doc.traefik.io/traefik/middlewares/http/forwardauth/">forwardauth</a> and redirects to a service called <strong>authentik-proxy</strong>, e.g. <code>traefik.http.middlewares.authentik.forwardauth.address: http://authentik-proxy:9000/outpost.goauthentik.io/auth/traefik</code></li>
<li><code>authentik-proxy</code> service integrates with Traefik's reverse proxy and acts as a <strong>authentication gateway</strong> to Authentik's <strong>outpost</strong></li>
<li>an outpost in Authentik is a deployment that acts as a bridge between Authentik and external services, handling authentication and authorization. </li>
<li>in Authentik (our identity broker) we need to register</li>
<li><strong>Application</strong>: basically a name and a URL where the application can be found. It is onnected to one provider</li>
<li><strong>Provider</strong>: the mechanism we use <em>how</em> to provide authentication and <em>source of the users</em>. For our use-case, we take a <strong>Proxy Provider</strong> of type <strong>Forward Auth</strong> at domain level, as all the service pages should be protected the same way. A provider can be connected to many applications.</li>
<li><strong>Outpost</strong>: an entity that talks to the Authentik-proxy service and provides a AUTHENTIK_TOKEN for that service. It is also connected to the provider. </li>
<li>for every service page that we would like to protect, we have to tell Traefik's router to use the <code>authentik</code> middleware defined earlier, e.g. <code>traefik.http.routers.dashboard.middlewares=authentik</code></li>
</ul>
<p>The following sequence diagram illustrates the authentication mechanism.</p>
<pre><div class="mermaid">
sequenceDiagram
  autonumber
  participant U as User Browser
  participant T as Traefik&lt;br/&gt;(reverse-proxy)
  participant S as Service Page
  participant O as authentik-proxy&lt;br/&gt;(outpost)
  participant AO as Authentik outpost
  participant AP as Authentik provider
  participant I as LDAP&lt;br/&gt;(identity provider)

  U -) T: request access to service page
  T -) T: is user authenticated (cookie 🔑)?
  T -) O: redirect to outpost
  O -) AO: redirect to authentication (AUTHENTIK_TOKEN 🔑)
  AO -) AP: redirect to login page
  AP -) U: ask for username
  U -) AP: enter username
  AP -) I: check username exists
  I -) AP: OK
  AP -) I: authorization: username is in allowed groups
  I -) AP: OK
  AP -) U: ask for password (plus OTP, if needed)
  U -) AP: enter password 🔑
  AP -) I: check password 🔑
  I -) AP: password OK
  AP -) O: redirect (cookie 🔑)
  O -) T: redirect (cookie 🔑)
  T -) S: access service page

  loop optional: sync users &amp; groups
     AP -) I: get users, groups
     I -) AP: users, groups
  end

</div></pre>
</article>
</div>
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": ".", "features": ["toc.follow", "toc.integrate"], "search": "assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
<script src="assets/javascripts/bundle.f55a23d4.min.js"></script>
<script src="assets/javascripts/panzoom.min.js"></script>
<script src="assets/javascripts/zoompan.js"></script>
<script type="module">import mermaid from "https://unpkg.com/mermaid@10.4.0/dist/mermaid.esm.min.mjs";
mermaid.initialize({});</script></body>
</html>